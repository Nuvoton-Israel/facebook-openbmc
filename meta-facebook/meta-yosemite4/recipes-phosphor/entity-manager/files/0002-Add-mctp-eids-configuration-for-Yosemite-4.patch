From a8ab37aa2e47d7b30550ba1a5e9ed614b4bb43b3 Mon Sep 17 00:00:00 2001
From: Delphine CC Chiu <Delphine_CC_Chiu@wiwynn.com>
Date: Mon, 25 Sep 2023 11:10:46 +0800
Subject: [PATCH 2/2] Add mctp eids configuration for Yosemite 4

The MCTP specification is defined in DSP0236. As describe in section
8.17.2, we need a configuration for static EIDs. The `mctpd` from
CodeConstuct/mctp will be able to know where those static EIDs located.
The other services will be able to know what those EIDs stand for by the
"Name" as well.

schemas: add `EndpointId` with type `string` and `number`.

Tested: check D-Bus path for configuration.
Change-Id: I587f5a69051f783753f5855d2f51242aa1cd5bc4
Signed-off-by: Delphine CC Chiu <Delphine_CC_Chiu@wiwynn.com>
---
 configurations/yosemite4_floatingfalls.json | 27 ++++++++++++++++
 configurations/yosemite4_sentineldome.json  | 20 ++++++++++++
 configurations/yosemite4_wailuafalls.json   | 34 +++++++++++++++++++++
 meson.build                                 |  3 ++
 schemas/legacy.json                         |  6 ++++
 5 files changed, 90 insertions(+)
 create mode 100644 configurations/yosemite4_floatingfalls.json
 create mode 100644 configurations/yosemite4_sentineldome.json
 create mode 100644 configurations/yosemite4_wailuafalls.json

diff --git a/configurations/yosemite4_floatingfalls.json b/configurations/yosemite4_floatingfalls.json
new file mode 100644
index 0000000..44cefe1
--- /dev/null
+++ b/configurations/yosemite4_floatingfalls.json
@@ -0,0 +1,27 @@
+{
+    "Exposes": [
+        {
+            "Address": "0x20",
+            "Bus": "mctpi2c$bus % 16",
+            "EndpointId": "$bus % 15 * 10 + 1",
+            "Name": "BIC",
+            "Type": "MCTPEndpoint"
+        },
+        {
+            "Address": "0x20",
+            "Bus": "mctpi2c$bus % 16",
+            "EndpointId": "$bus % 15 * 10 + 3",
+            "Name": "CXL",
+            "Type": "MCTPEndpoint"
+        }
+    ],
+    "Name": "Yosemite 4 Floating Falls Slot $bus % 15",
+    "Probe": "xyz.openbmc_project.FruDevice({'BOARD_PRODUCT_NAME': 'Floating Falls', 'PRODUCT_PRODUCT_NAME': 'Yosemite V4'})",
+    "Type": "Board",
+    "xyz.openbmc_project.Inventory.Decorator.Asset": {
+        "Manufacturer": "$PRODUCT_MANUFACTURER",
+        "Model": "$PRODUCT_PRODUCT_NAME",
+        "PartNumber": "$PRODUCT_PART_NUMBER",
+        "SerialNumber": "$PRODUCT_SERIAL_NUMBER"
+    }
+}
diff --git a/configurations/yosemite4_sentineldome.json b/configurations/yosemite4_sentineldome.json
new file mode 100644
index 0000000..f031ced
--- /dev/null
+++ b/configurations/yosemite4_sentineldome.json
@@ -0,0 +1,20 @@
+{
+    "Exposes": [
+        {
+            "Address": "0x20",
+            "Bus": "mctpi2c$bus % 16",
+            "EndpointId": "$bus % 15 * 10",
+            "Name": "BIC",
+            "Type": "MCTPEndpoint"
+        }
+    ],
+    "Name": "Yosemite 4 Sentinel Dome Slot $bus % 15",
+    "Probe": "xyz.openbmc_project.FruDevice({'BOARD_PRODUCT_NAME': 'Sentinel Dome', 'PRODUCT_PRODUCT_NAME': 'Yosemite V4'})",
+    "Type": "Board",
+    "xyz.openbmc_project.Inventory.Decorator.Asset": {
+        "Manufacturer": "$PRODUCT_MANUFACTURER",
+        "Model": "$PRODUCT_PRODUCT_NAME",
+        "PartNumber": "$PRODUCT_PART_NUMBER",
+        "SerialNumber": "$PRODUCT_SERIAL_NUMBER"
+    }
+}
diff --git a/configurations/yosemite4_wailuafalls.json b/configurations/yosemite4_wailuafalls.json
new file mode 100644
index 0000000..341dfae
--- /dev/null
+++ b/configurations/yosemite4_wailuafalls.json
@@ -0,0 +1,34 @@
+{
+    "Exposes": [
+        {
+            "Address": "0x20",
+            "Bus": "mctpi2c$bus % 16",
+            "EndpointId": "$bus % 15 * 10 + 2",
+            "Name": "BIC",
+            "Type": "MCTPEndpoint"
+        },
+        {
+            "Address": "0x20",
+            "Bus": "mctpi2c$bus % 16",
+            "EndpointId": "$bus % 15 * 10 + 4",
+            "Name": "CXL1",
+            "Type": "MCTPEndpoint"
+        },
+        {
+            "Address": "0x20",
+            "Bus": "mctpi2c$bus % 16",
+            "EndpointId": "$bus % 15 * 10 + 5",
+            "Name": "CXL2",
+            "Type": "MCTPEndpoint"
+        }
+    ],
+    "Name": "Yosemite 4 Wailua Falls Slot $bus % 15",
+    "Probe": "xyz.openbmc_project.FruDevice({'BOARD_PRODUCT_NAME': 'Wailua Falls', 'PRODUCT_PRODUCT_NAME': 'Yosemite V4'})",
+    "Type": "Board",
+    "xyz.openbmc_project.Inventory.Decorator.Asset": {
+        "Manufacturer": "$PRODUCT_MANUFACTURER",
+        "Model": "$PRODUCT_PRODUCT_NAME",
+        "PartNumber": "$PRODUCT_PART_NUMBER",
+        "SerialNumber": "$PRODUCT_SERIAL_NUMBER"
+    }
+}
diff --git a/meson.build b/meson.build
index 5dd04f9..eacff55 100644
--- a/meson.build
+++ b/meson.build
@@ -162,6 +162,9 @@ configs = [
     'yosemite4.json',
     'yosemite4_medusaboard.json',
     'yosemite4_spiderboard.json',
+    'yosemite4_sentineldome.json',
+    'yosemite4_floatingfalls.json',
+    'yosemite4_wailuafalls.json',
 ]
 filepaths = []
 foreach c : configs
diff --git a/schemas/legacy.json b/schemas/legacy.json
index b010d07..551f371 100644
--- a/schemas/legacy.json
+++ b/schemas/legacy.json
@@ -69,6 +69,9 @@
                 "EntityInstance": {
                     "$ref": "#/definitions/Types/EntityInstance"
                 },
+                "EndpointId": {
+                    "$ref": "#/definitions/Types/EndpointId"
+                },
                 "FaultIndex": {
                     "$ref": "#/definitions/Types/FaultIndex"
                 },
@@ -689,6 +692,9 @@
             "EntityInstance": {
                 "type": "number"
             },
+            "EndpointId": {
+                "type": ["string", "number"]
+            },
             "FaultIndex": {
                 "type": "number"
             },
-- 
2.25.1

