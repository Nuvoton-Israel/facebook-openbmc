From 0f0fd7721fdbb9ad87c37a4b2e085dbf8568931c Mon Sep 17 00:00:00 2001
From: DelphineCCChiu <delphine_cc_chiu@wiwynn.com>
Date: Tue, 23 Apr 2024 13:57:49 +0800
Subject: [PATCH 04/13] platform-mc: Monitor all sensors once upon the first
 power-on

BMC reads all sensors once upon reboot, then update sensor values
according to the update interval time.

Change-Id: I489bf370dfa9b511ad3004431504ddc96c3ac0a4
Signed-off-by: DelphineCCChiu <delphine_cc_chiu@wiwynn.com>
---
 platform-mc/sensor_manager.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/platform-mc/sensor_manager.cpp b/platform-mc/sensor_manager.cpp
index c1acf66..588b283 100644
--- a/platform-mc/sensor_manager.cpp
+++ b/platform-mc/sensor_manager.cpp
@@ -184,7 +184,7 @@ void SensorManager::doSensorPolling(pldm_tid_t tid)
             rcOpt = PLDM_SUCCESS;
         }
     }),
-                exec::default_task_context<void>());
+                exec::default_task_context<void>(exec::inline_scheduler{}));
 }
 
 exec::task<int> SensorManager::doSensorPollingTask(pldm_tid_t tid)
@@ -259,7 +259,7 @@ exec::task<int> SensorManager::doSensorPollingTask(pldm_tid_t tid)
 
             sd_event_now(event.get(), CLOCK_MONOTONIC, &t1);
             elapsed = t1 - sensor->timeStamp;
-            if (sensor->updateTime <= elapsed)
+            if ((sensor->updateTime <= elapsed) || (sensor->timeStamp == 0))
             {
                 rc = co_await getSensorReading(sensor);
 
-- 
2.43.5

